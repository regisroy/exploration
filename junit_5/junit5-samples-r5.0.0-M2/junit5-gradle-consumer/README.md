# junit5-gradle-consumer

The `junit5-gradle-consumer` project demonstrates how to run tests based on
JUnit 5 snapshots using Gradle with the help of a very basic JUnit Gradle plugin.

## Enabling the JUnit Gradle Plugin

To use the JUnit Gradle plugin, you first need to configure `build.gradle` as follows.

```groovy
buildscript {
	repositories {
		mavenCentral()
	}
	dependencies {
		classpath 'org.junit.platform:junit-platform-gradle-plugin:1.0.0-M2'
	}
}

apply plugin: 'org.junit.platform.gradle.plugin'
```

## Configuring the JUnit Gradle Plugin

Once the JUnit Gradle plugin has been applied, you can configure it as follows.

```groovy
junitPlatform {
	// platformVersion '1.0.0-SNAPSHOT'
	engines {
		// include 'junit-jupiter', 'junit-vintage'
		// exclude 'custom-engine'
	}
	tags {
		// include 'fast'
		exclude 'slow'
	}
	includeClassNamePattern '.*Test'
	// enableStandardTestTask true
	// reportsDir "build/test-results/junit-platform" // this is the default
	logManager 'org.apache.logging.log4j.jul.LogManager'
}
```

By default all engines and tags are included in the test plan.

If you supply a _Test Engine ID_ via `engines {include ...}` or `engines {exclude ...}`,
the JUnit Gradle plugin will only run tests for the desired test engines.

If you supply a _tag_ via `tags {include ...}`, the JUnit Gradle plugin will only
run tests that are _tagged_ accordingly (e.g., via the `@Tag` annotation for
JUnit Jupiter based tests). Similarly, if you supply a _tag_ via `tags {exclude ...}`,
the JUnit Gradle plugin will not run tests that are _tagged_ accordingly.

By default, the JUnit Gradle plugin disables the standard Gradle `test` task, but
this be overridden via the `enableStandardTestTask` flag.

## Configuring Test Engines

In order to have the JUnit Gradle plugin run any tests at all, a TestEngine
implementation must be on the classpath.

To configure support for JUnit Jupiter based tests, configure a `testCompile` dependency
on the JUnit Jupiter API and a `testRuntime` dependency on the JUnit Jupiter TestEngine
implementation similar to the following.

```groovy
dependencies {
	testCompile("org.junit.jupiter:junit-jupiter-api:5.0.0-M2")
	testRuntime("org.junit.jupiter:junit-jupiter-engine:5.0.0-M2")
}
```

The JUnit Gradle plugin can also run JUnit 3 and JUnit 4 based tests as long as you
configure a `testCompile` dependency on JUnit 4 and a `testRuntime` dependency on the
JUnit Vintage TestEngine implementation similar to the following.

```groovy
dependencies {
	testCompile("junit:junit:4.12")
	testRuntime("org.junit.vintage:junit-vintage-engine:4.12.0-M2")
}
```

## Executing Tests on the JUnit Platform

Once the JUnit Gradle plugin has been applied and configured, you have a new
`junitPlatformTest` task at your disposal.

Invoking `gradlew clean junitPlatformTest` (or `gradlew clean test`) from the command
line will execute all tests within the project whose class names match the pattern
`.*Test`. This will result in output similar to the following:

```
:junitPlatformTest

Test run finished after 115 ms
[         3 tests found     ]
[         1 tests skipped   ]
[         2 tests started   ]
[         0 tests aborted   ]
[         2 tests successful]
[         0 tests failed    ]

BUILD SUCCESSFUL
```

If you comment out the `@Disabled` annotation on `SecondTest#mySecondTest()`, you will
then see the build fail with output similar to the following:

```
:junitPlatformTest

Test failures (1):
  JUnit Jupiter:SecondTest:mySecondTest()
    JavaMethodSource [javaClass = 'com.example.project.SecondTest', javaMethodName = 'mySecondTest', javaMethodParameterTypes = '']
    => Exception: 2 is not equal to 1 ==> expected: <2> but was: <1>

Test run finished after 89 ms
[         3 tests found     ]
[         0 tests skipped   ]
[         3 tests started   ]
[         0 tests aborted   ]
[         2 tests successful]
[         1 tests failed    ]

:junitPlatformTest FAILED

FAILURE: Build failed with an exception.

* What went wrong:
Execution failed for task ':junitPlatformTest'.
> Process 'command '/Library/Java/JavaVirtualMachines/jdk1.8.0_92.jdk/Contents/Home/bin/java'' finished with non-zero exit value 1
```

**Note**: the _exit value_ corresponds to the number of _tests failed_.

### Current Limitations

- The results of any tests run via the JUnit Gradle plugin will not be included
  in the standard test report generated by Gradle; however, the test results
  can be aggregated. See the `reportsDir` property of the plugin.
